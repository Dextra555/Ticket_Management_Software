var get_appointments = '../appointment/get_appointments';
    add_calendar_event = '../appointment/add_calendar_event';
    get_app_details = '../appointment/get_calander_view_appointment_details';


var AppCalendar = function() {
    return {
        init: function() {
            this.initCalendar()
        },
        initCalendar: function() {
            if (jQuery().fullCalendar) {
                var e = new Date,
                    t = e.getDate(),
                    a = e.getMonth(),
                    n = e.getFullYear(),
                    r = {};
                App.isRTL() ? $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
                    right: "title, prev, next",
                    center: "",
                    left: "agendaDay, month, today" //agendaWeek
                }) : ($("#calendar").removeClass("mobile"), r = {
                    right: "title",
                    center: "",
                    left: " month, today, prev,next"//agendaDay, agendaWeek,
                }) : $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
                    left: "title, prev, next",
                    center: "",
                    right: "today,month" //,agendaWeek,agendaDay
                }) : ($("#calendar").removeClass("mobile"), r = {
                    left: "title",
                    center: "",
                    right: "prev,next,today,month"//,agendaWeek,agendaDay
                });
                var l = function(e) {
                        var t = {
                            title: $.trim(e.text())
                        };
                        e.data("eventObject", t), e.draggable({
                            zIndex: 999,
                            revert: !0,
                            revertDuration: 0
                        })
                    }
                var k = function(e) {
                        var b = {
                            title: $.trim(e.text())
                        };
                        e.data("eventObject", b), e.draggable({
                            zIndex: 999,
                            revert: !0,
                            revertDuration: 0
                        })
                    }
                    o = function(e) {
                        e = 0 === e.length ? "Untitled Event" : e;
                        var t = $('<div class="external-event label label-default">' + e + "</div>");
                        jQuery(".event_box").append(t), l(t)
                    };
                     a = function(e) {
                        e = 0 === e.length ? "Untitled Event" : e;
                        var b = $('<div class="external-event1 label label-default">' + e + "</div>");
                        jQuery("#event_box1").append(b), k(b)
                    };
                $("#external-events div.external-event").each(function() {
                    l($(this))
                }),$("#external-events1 div.external-event1").each(function() {
                    k($(this))
                }), $("#event_add").unbind("click").click(function() {
                    var e = $("#event_title").val();
                    o(e)
                    a(e)
                }),
                $(".event_box").html(""), o("My Event 1"), o("My Event 2"), o("My Event 3"), o("My Event 4"), o("My Event 5"), o("My Event 6");
                // $("#event_box1").html(""), a("My Event 1"), a("My Event 2"), a("My Event 3"), a("My Event 4"), a("My Event 5"), a("My Event 6");
                $("#calendar").fullCalendar("destroy");
            $.ajax({
                url: get_appointments,
                success: function(res) {
                     console.log(res);
                     var obj = JSON.parse(res);

                 $("#calendar").fullCalendar({
                    header: r,
                    defaultView: "month",
                    slotMinutes: 15,
                    editable: !0,
                    droppable: !0,
                    drop: function(e, t, event, jsEvent, view) {
                         var title = event.title;
                         var time = event.time;
                         alert(time)
                        var a = $(this).data("eventObject"),
                            n = $.extend({}, a);
                            n.start = e, n.allDay = t, n.className = $(this).attr("data-class"), $("#calendar").fullCalendar("renderEvent", n, !0), $("#drop-remove").is(":checked") && $(this).remove()
                        // alert(n.start)
                        // alert(n.title)
                        // console.log(n)
                        // console.log(a)
                    },
                    events: obj.events1, 
                   /* [{
                        title: "All Day Event",
                        start: new Date(n, a, 1),
                        backgroundColor: App.getBrandColor("yellow")
                    }, {
                        title: "Long Event",
                        start: new Date(n, a, t - 5),
                        end: new Date(n, a, t - 2),
                        backgroundColor: App.getBrandColor("green")
                    }, {
                        title: "Repeating Event",
                        start: new Date(n, a, t - 3, 16, 0),
                        allDay: !1,
                        backgroundColor: App.getBrandColor("red")
                    }, {
                        title: "Repeating Event",
                        start: new Date(n, a, t + 4, 16, 0),
                        allDay: !1,
                        backgroundColor: App.getBrandColor("green")
                    }, {
                        title: "Meeting",
                        start: new Date(n, a, t, 10, 30),
                        allDay: !1
                    }, {
                        title: "Lunch",
                        start: new Date(n, a, t, 12, 0),
                        end: new Date(n, a, t, 14, 0),
                        backgroundColor: App.getBrandColor("grey"),
                        allDay: !1
                    }, {
                        title: "Birthday Party",
                        start: new Date(n, a, t + 1, 19, 0),
                        end: new Date(n, a, t + 1, 22, 30),
                        backgroundColor: App.getBrandColor("purple"),
                        allDay: !1
                    }, {
                        title: "Click for Google",
                        start: new Date(n, a, 28),
                        end: new Date(n, a, 29),
                        backgroundColor: App.getBrandColor("yellow"),
                        url: "http://google.com/"
                    }]*/
                          eventClick: function(event, jsEvent, view) {
                             console.log();
                             // alert('afhj')
                            // var id = event.id;
                             var start = event.start;
                             var title = event.title;
                             var time = event.time;
                             // alert(time)
                           var check = moment(start).format('YYYY-MM-DD');
                           // alert(check)
                           // alert(title)
                           $.LoadingOverlay("show");
                             var data = 
                                        {
                                          // id: id
                                          start: check,
                                          title: title
                                        };  
                                   var fd = new FormData();
                                       // fd.append('id', data.id);
                                       fd.append('start', data.start);
                                       fd.append('title', data.title);
                                       
                                    $.ajax({
                                              url: get_app_details,
                                              type: 'POST',
                                              data: fd,
                                              contentType: false,
                                              processData: false,
                                              success: function(res) 
                                                  {
                                                     console.log(res);
                                                     var obj = JSON.parse(res);
                                                    // alert(obj.length)
                                                    if(obj.length > 0)
                                                    {
                                                        var output = "<table class='table'>";
                                                                output += "<tr><th>S.No</th><th>Name</th><th>Contact No</th><th>Address</th><th>Status</th><th>Remarks</th></tr>";
                                                                for (var i=0; i<obj.length; i++)
                                                                {
                                                                    var app_status = obj[i].app_status;
                                                                    if(app_status == '2')
                                                                    {
                                                                        app_status = 'Scheduled';
                                                                    }
                                                                    else if(app_status == '3')
                                                                    {
                                                                        app_status = 'Assigned';
                                                                    }
                                                                    else if(app_status == '4')
                                                                    {
                                                                        app_status = 'Completed';
                                                                    }
                                                                    else if(app_status == '5')
                                                                    {
                                                                        app_status = 'Rejected';
                                                                    }
                                                                    else if(app_status == '6')
                                                                    {
                                                                        app_status = 'Canceled';
                                                                    }
                                                                  output += "<tr><td>"+(i+1)+"</td><td>"+obj[i].name+"</td><td>"+obj[i].contact_number+"</td><td>"+obj[i].address+"</td><td>"+app_status+"</td><td>"+obj[i].scheduled_remarks+"</td></tr>";
                                                                }
                                                               output += "</table>";
                                                               var get_show_date = check;
                                                               var parts = get_show_date.split('-');
                                                               var clicked_date1 = parts[2] + '/' + parts[1] + '/' + parts[0];
                                                               $.LoadingOverlay("hide");
                                                       $.prompt("<p style='font-size: 15px; margin-top: 0;'><strong>Date:</strong> "+clicked_date1+"<br/><strong>Time:</strong> "+title+"</p> <hr> "+output, {
                                                            title: "<strong>Appointment</strong>",
                                                            buttons: { "Ok": true }
                                                        });

                                                     /*  $.prompt("<strong>Date:</strong>"+obj[i].scheduled_date+"<br/> <strong>Time:</strong> "+obj[i].scheduled_time+"<br/> <hr> <strong>Name: </strong> "+obj[i].name+" <br/> <strong> Phone Number:</strong> "+obj[i].contact_number+" <br/><strong> Address:</strong> "+obj[i].address+" <br/><strong> Remarks:</strong> "+obj[i].scheduled_remarks+" <br/><strong>Status:</strong> "+app_status+"", {
                                                            title: "Appointment",
                                                            buttons: { "Ok": true }
                                                        });*/
                                                    }
                                                                  
                                          $.LoadingOverlay("hide");
                                                  },
                                      error: function(err, ex) 
                                            {
                                                alert('Unable to Save details! Please try again later.');
                                                console.log(err.responseText, ex.message);
                                            }
                                       });

                            // window.location = event_info_page + '?id=' + event.id + '&title=' + event.title;
                        },
                        eventAfterAllRender: function(event,element) {

                        }
         
                })
                      }
            });
            }
    
        
        }

    }
}();
jQuery(document).ready(function() {
    AppCalendar.init()
   
});